<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<title>Lab: Deploying and Managing OpenShift Container Storage with Rook-Ceph Operator</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:initial}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px 0}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:.4em .75em 0 .75em;line-height:1;vertical-align:top}
.colist>table tr>td:first-of-type img{max-width:initial}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Lab: Deploying and Managing OpenShift Container Storage with Rook-Ceph Operator</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="_lab_overview">Lab Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This hands-on workshop is for both system administrators and application developers interested in learning how to deploy and manage OpenShift Container Storage (OCS). In this lab you will be using OpenShift Container Platform (OCP) 4.x and Rook to deploy Ceph as a persistent storage solution for OCP workloads.</p>
</div>
<div class="sect2">
<h3 id="_in_this_lab_you_will_learn_how_to">In this lab you will learn how to</h3>
<div class="ulist">
<ul>
<li>
<p>Configure and deploy containerized Ceph using Rook’s cluster CustomResourceDefinitions (CRD)</p>
</li>
<li>
<p>Validate deployment of Ceph Mimic containerized using OpenShift CLI</p>
</li>
<li>
<p>Deploy the Rook toolbox to run cn ceph and rados commands</p>
</li>
<li>
<p>Create a Persistent Volume (PV) on the Ceph cluster using a Rook OCP StorageClass for deployment of Rails application using a PostgreSQL database.</p>
</li>
<li>
<p>Upgrade Ceph version from Mimic to Nautilus using the Rook operator</p>
</li>
<li>
<p>Add more storage to the Ceph cluster</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="rook_diagram_3.png" alt="rook diagram 3">
</div>
<div class="title">Figure 1. Rook and Kubernetes Architecture</div>
</div>
<div class="imageblock">
<div class="content">
<img src="Rook_diagram_4.png" alt="Rook diagram 4">
</div>
<div class="title">Figure 2. Ceph deployed on OpenShift using Rook</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="labexercises">1. Deploy Ceph using Rook.io</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_scale_ocp_cluster_and_add_3_new_nodes">1.1. Scale OCP cluster and add 3 new nodes</h3>
<div class="paragraph">
<p>In this section, you will validate the OCP environment has 3 master and 3 worker nodes before increasing the cluster size by 3 worker nodes. The <code>NAME</code> of your OCP nodes will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get nodes
NAME                                         STATUS   ROLES    AGE    VERSION
ip-10-0-135-64.us-east-2.compute.internal    Ready    worker   117m   v1.13.4+da48e8391
ip-10-0-139-44.us-east-2.compute.internal    Ready    master   124m   v1.13.4+da48e8391
ip-10-0-146-50.us-east-2.compute.internal    Ready    worker   117m   v1.13.4+da48e8391
ip-10-0-147-157.us-east-2.compute.internal   Ready    master   124m   v1.13.4+da48e8391
ip-10-0-160-232.us-east-2.compute.internal   Ready    worker   118m   v1.13.4+da48e8391
ip-10-0-169-223.us-east-2.compute.internal   Ready    master   124m   v1.13.4+da48e8391</pre>
</div>
</div>
<div class="paragraph">
<p>Now you are going to add 3 more OCP compute nodes to cluster using <strong>machinesets</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get machinesets -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>This will show you the existing <strong>machinesets</strong> used to create the 3 worker nodes in the cluster already. There is a <strong>machineset</strong> for each AWS AZ (us-east-2a, us-east-2b, us-east-2a). Your <strong>machinesets</strong> <code>NAME</code> will be different than below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                   DESIRED   CURRENT   READY   AVAILABLE   AGE
cluster-a26e-rx8bk-worker-us-east-2a   1         1         1       1           127m
cluster-a26e-rx8bk-worker-us-east-2b   1         1         1       1           127m
cluster-a26e-rx8bk-worker-us-east-2c   1         1         1       1           127m</pre>
</div>
</div>
<div class="paragraph">
<p>To create the 3 new worker nodes with available storage you will download 3 more <strong>machineset</strong> definition files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/cluster-workerocs-us-east-2a.yaml
curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/cluster-workerocs-us-east-2b.yaml
curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/cluster-workerocs-us-east-2c.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>The files just downloaded do not have the correct <code>cluster-api-cluster</code> label for your lab because every environment is unique. This command will find the correct value.</p>
</div>
<div class="paragraph">
<p><strong>Make sure you do the next step for finding your CLUSTERID</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre>CLUSTERID=$(oc get machineset -n openshift-machine-api -o jsonpath='{.items[0].metadata.labels.machine\.openshift\.io/cluster-api-cluster}')
echo $CLUSTERID</pre>
</div>
</div>
<div class="paragraph">
<p>Using this correct <code>cluster-api-cluster</code> label for your lab environment modify each of the 3 <strong>machinesets</strong> downloaded earlier using the variable <code>$CLUSTERID</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sed -i "s/cluster-28cf-t22gs/$CLUSTERID/g" cluster-workerocs-us-east-2a.yaml
sed -i "s/cluster-28cf-t22gs/$CLUSTERID/g" cluster-workerocs-us-east-2b.yaml
sed -i "s/cluster-28cf-t22gs/$CLUSTERID/g" cluster-workerocs-us-east-2c.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Check that <code>cluster-api-cluster</code> label has been changed to <code>$CLUSTERID</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>grep cluster-api-cluster cluster-workerocs-us-east-2*</pre>
</div>
</div>
<div class="paragraph">
<p>The label for <code>cluster-api-cluster</code> should now match the results of <code>echo $CLUSTERID</code> from above for all occurrences.</p>
</div>
<div class="paragraph">
<p>Now you are ready to create your 3 new OCP worker nodes using these modified <strong>machinesets</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc create -f cluster-workerocs-us-east-2a.yaml
oc create -f cluster-workerocs-us-east-2b.yaml
oc create -f cluster-workerocs-us-east-2c.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Check that you have new <strong>machines</strong> created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get machines -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>They may be in <code>pending</code> for sometime so repeat command above until they are in a <code>running</code> STATE. The <code>NAME</code> of your machines will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                            INSTANCE              STATE     TYPE         REGION      ZONE         AGE
cluster-a26e-rx8bk-master-0                     i-097221131442bbfbb   running   m4.xlarge    us-east-2   us-east-2a   174m
cluster-a26e-rx8bk-master-1                     i-0267d53e93238917b   running   m4.xlarge    us-east-2   us-east-2b   174m
cluster-a26e-rx8bk-master-2                     i-01078f70ca5c9edb4   running   m4.xlarge    us-east-2   us-east-2c   174m
cluster-a26e-rx8bk-worker-us-east-2a-rbfzc      i-0866fa2a597f9b55c   running   m5.2xlarge   us-east-2   us-east-2a   174m
cluster-a26e-rx8bk-worker-us-east-2b-pk9k7      i-0c930c718134b2625   running   m5.2xlarge   us-east-2   us-east-2b   174m
cluster-a26e-rx8bk-worker-us-east-2c-v2jfq      i-0d5361d4219903e7c   running   m5.2xlarge   us-east-2   us-east-2c   173m
cluster-a26e-rx8bk-workerocs-us-east-2a-8pnf4   i-0a497998c19a59ba3   running   m5d.large    us-east-2   us-east-2a   4m1s
cluster-a26e-rx8bk-workerocs-us-east-2b-wwcmd   i-0c25eb473e452645d   running   m5d.large    us-east-2   us-east-2b   95s
cluster-a26e-rx8bk-workerocs-us-east-2c-8456v   i-0e0d311e4590fa7e3   running   m5d.large    us-east-2   us-east-2c   91s</pre>
</div>
</div>
<div class="paragraph">
<p>You can see that the workerocs <strong>machines</strong> are using a different AWS EC2 instance type <code>m5d.large</code>. This is because this EC2 instance type comes with a 75GB NVMe SSD that will be used for our storage cluster. Now you want to see if our new <strong>machines</strong> are added to the OCP cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>watch oc get machinesets -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>This step could take more than 5 minutes. The result of this command needs to look like below before you proceed. All new workerocs <strong>machinesets</strong> should have an integer, in this case <code>1</code>, filled out for all rows and under columns <code>READY</code> and <code>AVAILABLE</code>. The <code>NAME</code> of your <strong>machinesets</strong> will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>NAME                                      DESIRED   CURRENT   READY   AVAILABLE   AGE
cluster-a26e-rx8bk-worker-us-east-2a      1         1         1       1           179m
cluster-a26e-rx8bk-worker-us-east-2b      1         1         1       1           179m
cluster-a26e-rx8bk-worker-us-east-2c      1         1         1       1           179m
cluster-a26e-rx8bk-workerocs-us-east-2a   1         1         1       1           9m4s
cluster-a26e-rx8bk-workerocs-us-east-2b   1         1         1       1           6m38s
cluster-a26e-rx8bk-workerocs-us-east-2c   1         1         1       1           6m34s</pre>
</div>
</div>
<div class="paragraph">
<p>Now check to see that you have 3 new OCP worker nodes. The <code>NAME</code> of your OCP nodes will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get nodes -l node-role.kubernetes.io/worker

NAME                                         STATUS   ROLES    AGE     VERSION
ip-10-0-135-6.us-east-2.compute.internal     Ready    worker   5m58s   v1.13.4+da48e8391
ip-10-0-135-64.us-east-2.compute.internal    Ready    worker   175m    v1.13.4+da48e8391
ip-10-0-146-50.us-east-2.compute.internal    Ready    worker   175m    v1.13.4+da48e8391
ip-10-0-156-83.us-east-2.compute.internal    Ready    worker   3m7s    v1.12.4+30e6a0f55
ip-10-0-160-232.us-east-2.compute.internal   Ready    worker   176m    v1.13.4+da48e8391
ip-10-0-164-65.us-east-2.compute.internal    Ready    worker   3m30s   v1.12.4+30e6a0f55</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_download_rook_deployment_files_and_install_ceph">1.2. Download Rook deployment files and install Ceph</h3>
<div class="paragraph">
<p>In this section you will be using the new worker OCP nodes created in last section along with Rook image and configuration files. You will download files <strong>common.yaml</strong>, <strong>operator-openshift.yaml</strong>, <strong>cluster.yaml</strong> and <strong>toolbox.yaml</strong> to create Rook and Ceph resources as shown in Figure 1 and Figure 2 above.</p>
</div>
<div class="paragraph">
<p>First, validate that the 3 new OCP worker nodes are labeled with role=storage-node. This label was configured in each of the <strong>machinesets</strong> you used in last section so there is no need to manually add this label used for selecting OCP nodes for Rook deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get nodes --show-labels | grep storage-node</pre>
</div>
</div>
<div class="paragraph">
<p>The first step to deploy Rook is to create the common resources. The configuration for these resources will be the same for most deployments. The <strong>common.yaml</strong> sets these resources up.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/common.yaml
oc create -f common.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>After the common resources are created, the next step is to create the Operator deployment using <strong>operator-openshift.yaml</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/operator-openshift.yaml
oc create -f operator-openshift.yaml
watch oc get pods -n rook-ceph</pre>
</div>
</div>
<div class="paragraph">
<p>Wait for all <strong>rook-ceph-agent</strong>, <strong>rook-discover</strong> and <strong>rook-ceph-operator</strong> pods to be in a <code>Running</code> STATUS. The log for the <strong>rook-ceph-operator</strong> pod should show that the operator is looking for a cluster. Look for <code>the server could not find the requested resource (get clusters.ceph.rook.io)</code> in the <strong>rook-ceph-operator</strong> log file. This means the operator is looking for a Ceph cluster that does not exist yet.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>operator=$(oc get pod -l app=rook-ceph-operator -n rook-ceph -o jsonpath='{.items[0].metadata.name}')
echo $operator
oc logs $operator -n rook-ceph | grep "get clusters.ceph.rook.io"</pre>
</div>
</div>
<div class="paragraph">
<p>Now that your operator resources are running, the next step is to create your Ceph storage cluster. This <strong>cluster.yaml</strong> file contains settings for a production Ceph storage cluster. The minimum deployment requires at least 3 OCP nodes. In this lab these will be the OCP nodes created earlier using the AWS EC2 <code>m5d.large</code> instance type each with an available 75GB NVMe SSD.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/cluster.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Take a look at the <strong>cluster.yaml</strong> file. It specifies the version of Ceph and the label used for the rook resources. This label, <code>role=storage-node</code> was validated as being on our new OCP nodes at the beginning of this section. Also <code>useAllNodes=true</code> and <code>useAllDevices=true</code> means that if a OCP node has label <code>role=storage-node</code> then all available storage devices on this node will be used for the Ceph cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cat cluster.yaml
...
    image: ceph/ceph:v13.2.5-20190410
...

  placement:
    all:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
          - matchExpressions:
            - key: role
              operator: In
              values:
              - storage-node
...

  storage: # cluster level storage configuration and selection
    useAllNodes: true
    useAllDevices: true
    deviceFilter:
    location:
    config:
...</pre>
</div>
</div>
<div class="paragraph">
<p>Now create the Ceph resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc create -f cluster.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>It may take more than 5 minutes to create all of the new <strong>MONs</strong>, <strong>MGR</strong> and <strong>OSD</strong> pods. The <code>NAME</code> of your pods will be different than shown below.
*</p>
</div>
<div class="listingblock">
<div class="content">
<pre>watch oc get pods -n rook-ceph

NAME                                        READY    STATUS     RESTARTS    AGE
...
rook-ceph-mgr-a-86b5b58769-xngqm             1/1     Running     0          110s
rook-ceph-mon-a-f95bc46-2jffm                1/1     Running     0          3m13s
rook-ceph-mon-b-54588c7d68-prm8f             1/1     Running     0          2m45s
rook-ceph-mon-c-5567868987-t72zz             1/1     Running     0          2m24s
rook-ceph-operator-9bb6f7745-r7rft           1/1     Running     0          53m
rook-ceph-osd-0-88d4c654-lsz2m               1/1     Running     0          66s
rook-ceph-osd-1-55b49d48df-lvnlv             1/1     Running     0          66s
rook-ceph-osd-2-745b7669d7-gkhl5             1/1     Running     0          66s
rook-ceph-osd-prepare-ip-10-0-135-6-p8rsz    0/2     Completed   0          91s
rook-ceph-osd-prepare-ip-10-0-156-83-tjft2   0/2     Completed   0          91s
rook-ceph-osd-prepare-ip-10-0-164-65-9wq67   0/2     Completed   0          90s
...</pre>
</div>
</div>
<div class="paragraph">
<p>Once all pods are in a Running state it is time to verify that Ceph is operating correctly. Download <strong>toolbox.yaml</strong> to run Ceph commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/toolbox.yaml
oc create -f toolbox.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can login to <strong>rook-ceph-tools</strong> pod to run Ceph commands. This pod is commonly called the <strong>toolbox</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>toolbox=$(oc -n rook-ceph get pod -l "app=rook-ceph-tools" -o jsonpath='{.items[0].metadata.name}')
oc -n rook-ceph rsh $toolbox</pre>
</div>
</div>
<div class="paragraph">
<p>Once logged into the <strong>toolbox</strong> use commands below to investigate the Ceph status and configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ceph status
ceph osd status
ceph osd tree
ceph df
rados df</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to <code>exit</code> the <strong>toolbox</strong> before continuing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_create_rook_storageclass_for_creating_ceph_rbd_volumes">1.3. Create Rook storageclass for creating Ceph RBD volumes</h3>
<div class="paragraph">
<p>In this section you will download <strong>storageclass.yaml</strong> and then create the OCP <strong>storageclass</strong> <code>rook-ceph-block</code> that can be used by applications to dynamically claim persistent volumes (<strong>PVCs</strong>). The Ceph pool <code>replicapool</code> is created when the OCP <strong>storageclass</strong> is created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>curl -O https://raw.githubusercontent.com/red-hat-storage/ocs-training/master/ocp4rook/storageclass.yaml
cat  storageclass.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Notice the <code>provisioner: ceph.rook.io/block</code> and that <code>replicated: size=2</code> which is a good practice when there are only 3 OSDs. This is because if one <strong>OSD</strong> is down OCP volumes can continue to be created and used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc create -f storageclass.yaml</pre>
</div>
</div>
<div class="paragraph">
<p>Login to <strong>toolbox</strong> pod to run Ceph commands. Compare results for <code>ceph df</code> and <code>rados df</code> executed in prior section before the new <strong>storageclass</strong> was created. You will see there is now a Ceph pool called <code>replicapool</code>. Also, the command <code>ceph osd pool ls detail</code> gives you information on how this pool is configured.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc -n rook-ceph rsh $toolbox

ceph df
rados df
rados -p replicapool ls
ceph osd pool ls detail</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to <code>exit</code> the <strong>toolbox</strong> before continuing.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_new_ocp_deployment_using_ceph_rbd_volume">2. Create new OCP deployment using Ceph RBD volume</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section the <code>rook-ceph-block</code> <strong>storageclass</strong> will be used by an OCP application + database deployment to create persistent storage. The persistent storage will be a Ceph RBD (RADOS Block Device) volume (object) in the pool=<code>replicapool</code>.</p>
</div>
<div class="paragraph">
<p>Because the Rails + PostgreSQL deployment uses the <code>default</code> <strong>storageclass</strong> you need to modify the current default, gp2, and then make <code>rook-ceph-block</code> the default <strong>storageclass</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get sc

NAME              PROVISIONER             AGE
gp2 (default)     kubernetes.io/aws-ebs   2d
rook-ceph-block   ceph.rook.io/block      8m27s</pre>
</div>
</div>
<div class="paragraph">
<p>Now you want to change which <strong>storageclass</strong> is default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc edit sc gp2</pre>
</div>
</div>
<div class="paragraph">
<p>Remove this portion shown below from <strong>storageclass</strong> <code>gp2</code>. Make sure to note <strong>EXACTLY</strong> where this annotations is located in the <strong>storageclass</strong> (copying this portion to clipboard would be a good idea). The editing tool is <code>vi</code> when using <strong>oc edit</strong>. Make sure to save your changes before exiting <code>:wq!</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>  annotations:
    storageclass.kubernetes.io/is-default-class: "true"</pre>
</div>
</div>
<div class="paragraph">
<p>Add the removed portion to <code>rook-ceph-block</code> in same place in the file so it will become the <code>default</code> <strong>storageclass</strong>. Make sure to save your changes before exiting <code>:wq!</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc edit sc rook-ceph-block</pre>
</div>
</div>
<div class="paragraph">
<p>After editing <strong>storageclass</strong> <code>rook-ceph-block</code> the result should be similar to below and <code>rook-ceph-block</code> should now be the <code>default</code> <strong>storageclass</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get sc rook-ceph-block -o yaml

apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
  creationTimestamp: "2019-04-26T22:24:29Z"
  name: rook-ceph-block
...omitted...</pre>
</div>
</div>
<div class="paragraph">
<p>Validate that <code>rook-ceph-block</code> is now the default <strong>storageclass</strong> before starting the OCP application deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get sc

NAME                        PROVISIONER             AGE
gp2                         kubernetes.io/aws-ebs   2d1h
rook-ceph-block (default)   ceph.rook.io/block      10m32s</pre>
</div>
</div>
<div class="paragraph">
<p>Now you are ready to start the Rails + PostgreSQL deployment and monitor the deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc new-project my-database-app
oc new-app rails-pgsql-persistent -p VOLUME_CAPACITY=5Gi</pre>
</div>
</div>
<div class="paragraph">
<p>After the deployment is started you can monitor with these commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc status
oc get pvc -n my-database-app
watch oc get pods -n my-database-app</pre>
</div>
</div>
<div class="paragraph">
<p>This step could take 5 or more minutes. Wait until there are 2 pods in <code>Running</code> STATUS and 4 pods in <code>Completed</code> STATUS as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get pods -n my-database-app

NAME                                READY   STATUS      RESTARTS   AGE
postgresql-1-deploy                 0/1     Completed   0          5m48s
postgresql-1-lf7qt                  1/1     Running     0          5m40s
rails-pgsql-persistent-1-build      0/1     Completed   0          5m49s
rails-pgsql-persistent-1-deploy     0/1     Completed   0          3m36s
rails-pgsql-persistent-1-hook-pre   0/1     Completed   0          3m28s
rails-pgsql-persistent-1-pjh6q      1/1     Running     0          3m14s</pre>
</div>
</div>
<div class="paragraph">
<p>Once the deployment is complete you can now test the application and the persistent storage on Ceph. Your <code>HOST/PORT</code> will be different.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get route -n my-database-app

NAME                     HOST/PORT                                                                         PATH   SERVICES                 PORT    TERMINATION   WILDCARD
rails-pgsql-persistent   rails-pgsql-persistent-my-database-app.apps.cluster-a26e.sandbox449.opentlc.com          rails-pgsql-persistent</pre>
</div>
</div>
<div class="paragraph">
<p>Copy your <code>HOST/PORT</code> to a browser window to create articles. You will need to append <code>/articles</code> to the end.</p>
</div>
<div class="paragraph">
<p><strong>Example link:</strong>  <a href="http://rails-pgsql-persistent-my-database-app.apps.cluster-a26e.sandbox449.opentlc.com" class="bare">http://rails-pgsql-persistent-my-database-app.apps.cluster-a26e.sandbox449.opentlc.com</a> /articles</p>
</div>
<div class="paragraph">
<p>Enter the <code>username</code> and <code>password</code> below to create articles and comments. The articles and comments are saved in a PostgreSQL database which stores its table spaces on the Ceph RBD volume provisioned using the <code>rook-ceph-block</code> <strong>storagclass</strong> during the application deployment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>username: openshift
password: secret</pre>
</div>
</div>
<div class="paragraph">
<p>Lets now take another look at the Ceph <code>replicapool</code> created by the <code>rook-ceph-block</code> <strong>storageclass</strong>. Log into the <strong>toolbox</strong> pod again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc -n rook-ceph rsh $toolbox</pre>
</div>
</div>
<div class="paragraph">
<p>Run the same Ceph commands as before the application deployment and compare to results in prior section. Notice the number of objects in <code>replicapool</code> now.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ceph df
rados df
rados -p replicapool ls | grep pvc</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to <code>exit</code> the <strong>toolbox</strong>. Validate the OCP <strong>PersistentVolume</strong> (PV) name is the same name as the volume name in the Ceph <code>replicapool</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get pvc -n my-database-app</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_using_rook_to_upgrade_ceph">3. Using Rook to Upgrade Ceph</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you will upgrade the Ceph version from <strong>Mimic</strong> to <strong>Nautilus</strong> using the Rook operator. First verify the current version by logging into the <strong>toolbox</strong> pod.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc -n rook-ceph rsh $toolbox
ceph version</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to <code>exit</code> the <strong>toolbox</strong> before continuing.</p>
</div>
<div class="paragraph">
<p>The result should be <code>ceph version 13.2.5 (cbff874f9007f1869bfd3821b7e33b2a6ffd4988) mimic (stable)</code>.</p>
</div>
<div class="paragraph">
<p>The next thing you need to do is update the cluster CRD with a current <strong>Nautilus</strong> image name and version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc edit cephcluster rook-ceph -n rook-ceph</pre>
</div>
</div>
<div class="paragraph">
<p>Modify the Ceph version in the cluster CRD. Using <code>oc edit</code> is the same as using editing tool <code>vi</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spec:
  cephVersion:
    image: ceph/ceph:v13.2.5-20190410</pre>
</div>
</div>
<div class="paragraph">
<p>To the version for Nautilus. Make sure to save your changes before exiting <code>:wq!</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>spec:
  cephVersion:
    image: ceph/ceph:v14.2.0-20190410</pre>
</div>
</div>
<div class="paragraph">
<p>This could step take 5 minutes or more. Once the change to the Ceph version is edited as shown above, the <strong>MONs</strong>, <strong>MGR</strong>, and <strong>OSD</strong> pods will be restarted. You can tell that they have been restarted when their <code>AGE</code> is seconds or just a few minutes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>watch oc get pods -n rook-ceph

NAME                                         READY   STATUS      RESTARTS   AGE
...
rook-ceph-mgr-a-777d64fb8f-q7tcz             1/1     Running     0          2m55s
rook-ceph-mon-a-5c7fcdfcc4-zwzb7             1/1     Running     0          3m18s
rook-ceph-mon-b-5597dbd64d-cdvjf             1/1     Running     0          4m33s
rook-ceph-mon-c-779cbf9bc-2rfl5              1/1     Running     0          3m58s
rook-ceph-operator-5f7967846f-zqqjl          1/1     Running     0          27h
rook-ceph-osd-0-855bc669cd-45sk7             1/1     Running     0          2m8s
rook-ceph-osd-1-7cc9cd8c8c-j9ffl             1/1     Running     0          115s
rook-ceph-osd-2-5977cd8bff-9x85n             1/1     Running     0          98s
...</pre>
</div>
</div>
<div class="paragraph">
<p>Now let&#8217;s check the version of Ceph to see if it is upgraded. First you need to login to the <strong>toolbox</strong> pod again.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc -n rook-ceph rsh $toolbox</pre>
</div>
</div>
<div class="paragraph">
<p>Running the <code>ceph versions</code> command shows each of the Ceph daemons (<strong>MONs</strong>, <strong>MGR</strong>, and <strong>OSD</strong>) have been upgraded to <strong>Nautilus</strong>. Run other Ceph commands to satisfy yourself (e.g., ceph status) the system is healthy after the Ceph upgrade from <strong>Mimic</strong> to <strong>Nautilus</strong>. You might even want to go back to the Rails + PostgreSQL application and save a few more articles to make sure Ceph storage is still working.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ceph versions

{
    "mon": {
        "ceph version 14.2.0 (3a54b2b6d167d4a2a19e003a705696d4fe619afc) nautilus (stable)": 3
    },
    "mgr": {
        "ceph version 14.2.0 (3a54b2b6d167d4a2a19e003a705696d4fe619afc) nautilus (stable)": 1
    },
    "osd": {
        "ceph version 14.2.0 (3a54b2b6d167d4a2a19e003a705696d4fe619afc) nautilus (stable)": 3
    },
    "mds": {},
    "overall": {
        "ceph version 14.2.0 (3a54b2b6d167d4a2a19e003a705696d4fe619afc) nautilus (stable)": 7
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to <code>exit</code> the <strong>toolbox</strong> before continuing.</p>
</div>
<div class="paragraph">
<p>You can also execute this command to easily look at both the Rook and Ceph versions currently running for the <strong>MONs</strong>, <strong>MGR</strong> and <strong>OSDs</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc -n rook-ceph get deployments -o jsonpath='{range .items[*]}{.metadata.name}{" \trook="}{.metadata.labels.rook-version}{" \tceph="}{.metadata.labels.ceph-version}{"\n"}{end}' | sed s/v0.9.0-557.g48380dd/v1.0.0/g

rook-ceph-mgr-a 	rook=v1.0.0 	ceph=14.2.0
rook-ceph-mon-a 	rook=v1.0.0 	ceph=14.2.0
rook-ceph-mon-b 	rook=v1.0.0 	ceph=14.2.0
rook-ceph-mon-c 	rook=v1.0.0 	ceph=14.2.0
rook-ceph-osd-0 	rook=v1.0.0 	ceph=14.2.0
rook-ceph-osd-1 	rook=v1.0.0 	ceph=14.2.0
rook-ceph-osd-2 	rook=v1.0.0 	ceph=14.2.0
rook-ceph-osd-3 	rook=v1.0.0 	ceph=14.2.0</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_adding_storage_to_the_ceph_cluster">4. Adding storage to the Ceph Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you will add more storage to the cluster by increasing the number of OCP workerocs <strong>machines</strong> and worker nodes from 3 to 4 using one of the <strong>machinesets</strong> you already used. The new <strong>machine</strong> will also be an EC2 instance <code>m5d.large</code> and have an available 75 GB NVMe SSD. The Rook operator will <code>observe</code> when the new OCP node is added to the cluster and will then create a new <strong>OSD</strong> pod on this new worker node and the 75 GB SSD will be added to the Ceph cluster with no additional manual effort from the user.</p>
</div>
<div class="paragraph">
<p>To increase the number of <strong>machines</strong> and the OCP nodes you will again use a <strong>machineset</strong>. Each of the <strong>machinesets</strong> you used earlier created just one machine because of <code>replicas: 1</code> in the configuration file. Your <code>cluster-api-cluster</code> and <code>name</code> is different than example shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>cat machineset cluster-workerocs-us-east-2a.yaml | more

apiVersion: machine.openshift.io/v1beta1
kind: MachineSet
metadata:
  labels:
    machine.openshift.io/cluster-api-cluster: cluster-a26e-rx8bk
    machine.openshift.io/cluster-api-machine-role: workerocs
    machine.openshift.io/cluster-api-machine-type: workerocs
  name: cluster-a26e-rx8bk-workerocs-us-east-2a
  namespace: openshift-machine-api
spec:
  replicas: 1
...</pre>
</div>
</div>
<div class="paragraph">
<p>Verify your <code>cluster-api-cluster</code> again by using the command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>echo $CLUSTERID</pre>
</div>
</div>
<div class="paragraph">
<p>You can easily create a new <strong>machine</strong> and OCP worker node in AWS AZ us-east-2a by just increasing the <code>replicas</code> count in one of the machinesets. Edit your machineset for us-east-2a to increase from <code>replicas: 1</code> to <code>replicas: 2</code>. Make sure to save your changes before exiting <code>:wq!</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc edit machineset $CLUSTERID-workerocs-us-east-2a -n openshift-machine-api</pre>
</div>
</div>
<div class="paragraph">
<p>Verify you now have 4 workerocs <strong>machines</strong>. One of the <strong>machines</strong> should have just been created in us-east-2a AZ so there are two in this AZ now. The <code>NAME</code> of your <strong>machines</strong> will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get machines -n openshift-machine-api

NAME                                            INSTANCE              STATE     TYPE         REGION      ZONE         AGE
...
cluster-a26e-rx8bk-workerocs-us-east-2a-8pnf4   i-0a497998c19a59ba3   running   m5d.large    us-east-2   us-east-2a   2d
cluster-a26e-rx8bk-workerocs-us-east-2a-l4v5l   i-0e22f1078f1228086   running   m5d.large    us-east-2   us-east-2a   33s
cluster-a26e-rx8bk-workerocs-us-east-2b-wwcmd   i-0c25eb473e452645d   running   m5d.large    us-east-2   us-east-2b   47h
cluster-a26e-rx8bk-workerocs-us-east-2c-8456v   i-0e0d311e4590fa7e3   running   m5d.large    us-east-2   us-east-2c   47h</pre>
</div>
</div>
<div class="paragraph">
<p>Now you need to verify that this new <strong>machine</strong> is added to the OCP cluster.</p>
</div>
<div class="paragraph">
<p>This step could take more than 5 minutes. You can see now that one of the <strong>machinesets</strong> has 2 machines, this is because you increased the replica count in the prior step. The <strong>machineset</strong> for us-east-2a should have an integer, in this case <code>2</code>, filled out for the entire row before you proceed to the next step. The <code>NAME</code> of your machinesets will be different than shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>watch oc get machinesets -n openshift-machine-api

NAME                                      DESIRED   CURRENT   READY   AVAILABLE   AGE
...
cluster-a26e-rx8bk-workerocs-us-east-2a   2         2         2       2           2d
cluster-a26e-rx8bk-workerocs-us-east-2b   1         1         1       1           2d
cluster-a26e-rx8bk-workerocs-us-east-2c   1         1         1       1           2d</pre>
</div>
</div>
<div class="paragraph">
<p>Now verify that you have a new OCP worker node. You should now have 7 worker nodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc get nodes -l node-role.kubernetes.io/worker

NAME                                         STATUS   ROLES    AGE     VERSION
ip-10-0-135-6.us-east-2.compute.internal     Ready    worker   2d      v1.13.4+da48e8391
ip-10-0-135-64.us-east-2.compute.internal    Ready    worker   2d2h    v1.13.4+da48e8391
ip-10-0-137-156.us-east-2.compute.internal   Ready    worker   4m28s   v1.13.4+da48e8391
ip-10-0-146-50.us-east-2.compute.internal    Ready    worker   2d2h    v1.13.4+da48e8391
ip-10-0-156-83.us-east-2.compute.internal    Ready    worker   2d      v1.13.4+da48e8391
ip-10-0-160-232.us-east-2.compute.internal   Ready    worker   2d2h    v1.13.4+da48e8391
ip-10-0-164-65.us-east-2.compute.internal    Ready    worker   2d      v1.13.4+da48e8391</pre>
</div>
</div>
<div class="paragraph">
<p>Until Openshift Container Platform 4.2 rolls out, we will need to restart (delete) the operator pod to see OSD pod added.</p>
</div>
<div class="listingblock execute">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc delete pod -l app=rook-ceph-operator -n rook-ceph</code></pre>
</div>
</div>
<div class="paragraph">
<p>This step could take 5 minutes or more for the forth <strong>OSD</strong> pod to be in a <code>Running</code> STATUS. Eventually your will see a new <strong>OSD</strong> pod, <code>rook-ceph-osd-3</code>, that has just been created.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>watch oc get pods -n rook-ceph

NAME                                          READY   STATUS      RESTARTS   AGE

...
rook-ceph-osd-0-855bc669cd-45sk7              1/1     Running     0          55m
rook-ceph-osd-1-7cc9cd8c8c-j9ffl              1/1     Running     0          55m
rook-ceph-osd-2-5977cd8bff-9x85n              1/1     Running     0          55m
rook-ceph-osd-3-56b6c4f459-q7mhz              1/1     Running     0          114s
...</pre>
</div>
</div>
<div class="paragraph">
<p>Now you can validate that Ceph is healthy and has the additional storage. You again login to the <strong>toolbox</strong> pod.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>oc -n rook-ceph rsh $toolbox</pre>
</div>
</div>
<div class="paragraph">
<p>And run Ceph commands to see the new OSDs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ceph osd status

+----+--------------------------------------------+-------+-------+--------+---------+--------+---------+-----------+
| id |                    host                    |  used | avail | wr ops | wr data | rd ops | rd data |   state   |
+----+--------------------------------------------+-------+-------+--------+---------+--------+---------+-----------+
| 0  |  ip-10-0-135-6.us-east-2.compute.internal  | 1051M | 68.8G |    0   |     0   |    0   |     0   | exists,up |
| 1  | ip-10-0-156-83.us-east-2.compute.internal  | 1060M | 68.8G |    0   |     0   |    0   |     0   | exists,up |
| 2  | ip-10-0-164-65.us-east-2.compute.internal  | 1062M | 68.8G |    0   |     0   |    0   |     0   | exists,up |
| 3  | ip-10-0-137-156.us-east-2.compute.internal | 1061M | 67.9G |    0   |     0   |    0   |     0   | exists,up |
+----+--------------------------------------------+-------+-------+--------+---------+--------+---------+-----------+</pre>
</div>
</div>
<div class="paragraph">
<p>And you can see that Ceph is healthy and happy! There are now 4 <strong>OSDs</strong> <code>up</code> and <code>in</code>. You might even want to go back to the the Rails + PostgreSQL application and save a few more articles to make sure applications using Ceph storage are still working.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ceph status

  cluster:
    id:     90306026-6e42-4877-9d4e-26eca2ecf6ef
    health: HEALTH_OK

  services:
    mon: 3 daemons, quorum b,a,c (age 59m)
    mgr: a(active, since 5m)
    osd: 4 osds: 4 up, 4 in

  data:
    pools:   1 pools, 100 pgs
    objects: 36 objects, 73 MiB
    usage:   4.1 GiB used, 274 GiB / 279 GiB avail
    pgs:     100 active+clean</pre>
</div>
</div>
<div class="paragraph">
<p>Make sure to <code>exit</code> the <strong>toolbox</strong>.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-10-21 16:18:36 CEST
</div>
</div>
</body>
</html>